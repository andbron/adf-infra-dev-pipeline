{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "factoryName": {
      "type": "String",
      "metadata": "Data Factory name"
    },
    "assetName": {
        "type": "String",
        "metadata": "Asset Name"
    },
    "linksvc_sftp": {
      "type": "String",
        "metadata": "SFTP Service Name"      
    },
    "linksvc_sftp_folderPath": {
        "type": "String",
        "metadata": "ADF Linked Service SFTP Folder Path Name"
    }      
  },
  "variables": {
    "factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]",
    "storage_blob_from": "[variables('storage_blob_from')]",
    "asset_sftp_service": "[variables('asset_sftp_service')]"
  },
  "resources": [
    {
      "name": "[concat(parameters('factoryName'), '/', parameters('assetName'), '-Pipeline')]",
      "type": "Microsoft.DataFactory/factories/pipelines",
      "apiVersion": "2018-06-01",
      "properties": {
        "activities": [
          {
            "name": "SyncData",
            "type": "Copy",
            "dependsOn": [],
            "policy": {
              "timeout": "7.00:00:00",
              "retry": 0,
              "retryIntervalInSeconds": 30,
              "secureOutput": false,
              "secureInput": false
            },
            "userProperties": [],
            "typeProperties": {
              "source": {
                "type": "BlobSource",
                "recursive": true
              },
              "sink": {
                "type": "BinarySink",
                "storeSettings": {
                  "type": "SftpWriteSettings",
                  "operationTimeout": "01:00:00",
                  "useTempFileRename": true
                }
              },
              "enableStaging": false
            },
            "inputs": [
              {
                "referenceName": "[variables('storage_blob_from')]",
                "type": "DatasetReference",
                "parameters": {}
              }
            ],
            "outputs": [
              {
                "referenceName": "[variables('asset_sftp_service')]",
                "type": "DatasetReference",
                "parameters": {}
              }
            ]
          }
        ],
        "annotations": []
      },
      "dependsOn": [
        "[concat(variables('factoryId'), '/datasets/', variables('storage_blob_from'))]",
        "[concat(variables('factoryId'), '/datasets/', variables('asset_sftp_service'))]"
      ]
    },
    {
      "name": "[concat(parameters('factoryName'), variables('storage_blob_from'))]",
      "type": "Microsoft.DataFactory/factories/datasets",
      "apiVersion": "2018-06-01",
      "properties": {
        "linkedServiceName": {
          "referenceName": "[concat(parameters('factoryName'), variables('storage_blob_from'))]",
          "type": "LinkedServiceReference"
        },
        "annotations": [],
        "type": "AzureBlob",
        "typeProperties": {
          "fileName": "testData04.csv",
          "folderPath": "001-from"
        }
      },
      "dependsOn": []
    },
    {
      "name": "[concat(parameters('factoryName'), '/', variables('asset_sftp_service'))]",
      "type": "Microsoft.DataFactory/factories/datasets",
      "apiVersion": "2018-06-01",
      "properties": {
        "linkedServiceName": {
          "referenceName": "[parameters('linksvc_sftp')]",
          "type": "LinkedServiceReference"
        },
        "annotations": [],
        "type": "Binary",
        "typeProperties": {
          "location": {
            "type": "SftpLocation",
            "folderPath": "[parameters('linksvc_sftp_folderPath')]"
          }
        }
      },
      "dependsOn": []
    }
  ]
}